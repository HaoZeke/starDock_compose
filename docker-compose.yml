#########################
# StarDock Compose File #
#########################

version: '3'

services:

  # Reverse Proxy
  ################

  # Traefik

  proxy:
    image: traefik
    container_name: Traefik
    command: --logLevel=DEBUG
    networks:
      - webgateway
    ports:
      - "80:80"
      - "8080:8080"
    volumes:
      - ${DSOCK}:/var/run/docker.sock
      - ./configs/traefik.toml:/traefik.toml

  # Management Tools
  ###################

  # WatchTower

  watchtower:
    image: v2tec/watchtower
    container_name: "Watchtower"
    restart: unless-stopped
    command: --cleanup --interval 43200
    networks:
      - webgateway
    environment:
      - WATCHTOWER_NOTIFICATIONS=email
      - WATCHTOWER_NOTIFICATION_EMAIL_FROM=${WATCHTOWER_NOTIFICATION_EMAIL_FROM}
      - WATCHTOWER_NOTIFICATION_EMAIL_TO=${WATCHTOWER_NOTIFICATION_EMAIL_TO}
      - WATCHTOWER_NOTIFICATION_EMAIL_SERVER=${WATCHTOWER_NOTIFICATION_EMAIL_SERVER}
      - WATCHTOWER_NOTIFICATION_EMAIL_SERVER_USER=${WATCHTOWER_NOTIFICATION_EMAIL_SERVER_USER}
      - WATCHTOWER_NOTIFICATION_EMAIL_SERVER_PASSWORD=${WATCHTOWER_NOTIFICATION_EMAIL_SERVER_PASSWORD}
    volumes:
      - ${DSOCK}:/var/run/docker.sock

  # Portrainer

  portainer:
    image: portainer/portainer
    container_name: Portainer
    restart: unless-stopped
    networks:
      - webgateway
    labels:
      - "traefik.backend=portainer"
      - "traefik.frontend.rule=PathPrefixStrip: /portainer/"
    volumes:
      - ${PORTAINER_DATA_PATH}:/data
      - ${DSOCK}:/var/run/docker.sock

  # Media Servers
  ################

  # Plex
  plex:
    image: linuxserver/plex 
    container_name: "ArchPlex"
    # hostname: "ArchPlexDocker"
    restart: unless-stopped
    network_mode: host
    # networks:
    #   - webgateway
    # labels:
    #   - "traefik.backend=plex"
    #   - "traefik.port=32400"
    #   - "traefik.frontend.rule=PathPrefixStrip: /plex/"
    volumes:
      - /home/haozeke/Storage/Docker/archPlex/config:/config
      - /home/haozeke/Storage/Docker/archPlex/transcode:/transcode
      - /home/haozeke/Storage/Docker/archPlex/logs:/logs
      - /home/haozeke/Storage/TV:/data/Storage/TV
      - /home/haozeke/Storage/Anime:/data/Storage/Anime
      - /home/haozeke/Storage/Movies:/data/Storage/Movies
      - /home/haozeke/Storage/Videos:/data/Storage/Videos
      - /home/haozeke/Storage/Xiaomi/TV:/data/Xiaomi/TV
      - /home/haozeke/Storage/Xiaomi/Anime:/data/Xiaomi/Anime
      - /home/haozeke/Storage/Xiaomi/Movies:/data/Xiaomi/Movies
      - /home/haozeke/Storage/Xiaomi/Videos:/data/Xiaomi/Videos

networks:
    webgateway:
      driver: bridge