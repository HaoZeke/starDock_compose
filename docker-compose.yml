version: '3'

services:

  # Reverse Proxy Stuff

  # Traefik

  proxy:
    image: traefik
    container_name: Traefik
    command: --logLevel=DEBUG
    networks:
      - webgateway
    ports:
      - "80:80"
      - "8080:8080"
    volumes:
      - ${DSOCK}:/var/run/docker.sock
      - ./configs/traefik.toml:/traefik.toml

  # Management Tools

  # WatchTower

  watchtower:
    image: v2tec/watchtower
    container_name: "Watchtower"
    restart: unless-stopped
    command: --cleanup --interval 43200
    networks:
      - webgateway
    environment:
      - WATCHTOWER_NOTIFICATIONS=email
      - WATCHTOWER_NOTIFICATION_EMAIL_FROM=${WATCHTOWER_NOTIFICATION_EMAIL_FROM}
      - WATCHTOWER_NOTIFICATION_EMAIL_TO=${WATCHTOWER_NOTIFICATION_EMAIL_TO}
      - WATCHTOWER_NOTIFICATION_EMAIL_SERVER=${WATCHTOWER_NOTIFICATION_EMAIL_SERVER}
      - WATCHTOWER_NOTIFICATION_EMAIL_SERVER_USER=${WATCHTOWER_NOTIFICATION_EMAIL_SERVER_USER}
      - WATCHTOWER_NOTIFICATION_EMAIL_SERVER_PASSWORD=${WATCHTOWER_NOTIFICATION_EMAIL_SERVER_PASSWORD}
    volumes:
      - ${DSOCK}:/var/run/docker.sock

  # Portrainer Setup

  portainer:
    image: portainer/portainer
    container_name: Portainer
    restart: unless-stopped
    networks:
      - webgateway
    labels:
      - "traefik.backend=portainer"
      - "traefik.frontend.rule=PathPrefixStrip: /portainer/"
    volumes:
      - ${PORTAINER_DATA_PATH}:/data
      - ${DSOCK}:/var/run/docker.sock

networks:
    webgateway:
      driver: bridge